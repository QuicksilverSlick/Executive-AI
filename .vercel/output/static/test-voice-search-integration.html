<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Voice Search Integration Test</title><style>body{font-family:system-ui,-apple-system,sans-serif;max-width:800px;margin:0 auto;padding:20px;background:#f8fafc}.container{background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1)}.test-section{margin:20px 0;padding:20px;border:1px solid #e2e8f0;border-radius:8px;background:#f8fafc}.result{margin:10px 0;padding:10px;border-radius:6px}.success{background:#dcfce7;border:1px solid #16a34a;color:#15803d}.error{background:#fee2e2;border:1px solid #dc2626;color:#dc2626}.info{background:#dbeafe;border:1px solid #2563eb;color:#1d4ed8}button{background:#3b82f6;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;margin:5px}button:hover{background:#2563eb}button:disabled{background:#94a3b8;cursor:not-allowed}.log{background:#1e293b;color:#e2e8f0;padding:15px;border-radius:6px;font-family:Monaco,Consolas,monospace;font-size:12px;max-height:300px;overflow-y:auto;white-space:pre-wrap;margin:10px 0}</style></head><body><div class=container><h1>üîç Voice Search Integration Test</h1><p>This test verifies that the web search function call integration works properly with the voice agent.</p><div class=test-section><h2>1. Direct API Test</h2><p>Test the responses-search endpoint directly</p><button onclick=testDirectAPI()>Test API</button><div id=direct-api-result></div></div><div class=test-section><h2>2. Function Call Simulation</h2><p>Simulate a web_search function call from the voice agent</p><button onclick=testFunctionCall()>Test Function Call</button><div id=function-call-result></div></div><div class=test-section><h2>3. Voice Agent Integration</h2><p>Test the actual integration with voice agent components</p><button onclick=testVoiceIntegration()>Test Voice Integration</button><div id=voice-integration-result></div></div><div class=test-section><h2>4. Citation Extraction Test</h2><p>Verify that citations are properly extracted from search results</p><button onclick=testCitationExtraction()>Test Citations</button><div id=citation-result></div></div><div class=test-section><h2>Debug Log</h2><button onclick=clearLog()>Clear Log</button><div class=log id=debug-log></div></div></div><script>let testCounter=0;function log(e){const t=document.getElementById("debug-log"),s=(new Date).toLocaleTimeString();t.textContent+=`[${s}] ${e}\n`,t.scrollTop=t.scrollHeight,console.log(e)}function showResult(e,t,s="info"){const o=document.getElementById(e),n=document.createElement("div");n.className=`result ${s}`,n.textContent=t,o.appendChild(n)}function clearLog(){document.getElementById("debug-log").textContent=""}async function testDirectAPI(){log("üß™ Starting Direct API Test");document.getElementById("direct-api-result").innerHTML="";try{const e="What are the latest developments in AI?";log(`üì° Calling API with query: "${e}"`);const t=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})}),s=await t.json();log(`üìä Response status: ${t.status}`),log(`üìÑ Response data: ${JSON.stringify(s,null,2).substring(0,200)}...`),t.ok&&s.success?(showResult("direct-api-result",`‚úÖ API test passed: ${s.searchResults?.length||0} results, ${s.citations?.length||0} citations`,"success"),s.searchResults&&s.searchResults.length>0&&showResult("direct-api-result",`üîç First result: ${s.searchResults[0].title}`,"info")):showResult("direct-api-result",`‚ùå API test failed: ${s.error||"Unknown error"}`,"error")}catch(e){log(`‚ùå Direct API test error: ${e.message}`),showResult("direct-api-result",`‚ùå Error: ${e.message}`,"error")}}async function testFunctionCall(){log("ü§ñ Starting Function Call Simulation");document.getElementById("function-call-result").innerHTML="";try{const e="test_call_"+ ++testCounter,t="How to optimize JavaScript performance?";log(`üìû Simulating function call: ${e}`),log(`üîç Query: "${t}"`);const s=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,conversationContext:"User is asking about performance optimization"})}),o=await s.json();if(log(`üì° Search API status: ${s.status}`),!s.ok)throw new Error(`Search API error: ${o.error}`);const n={success:o.success,query:t,response:o.response,searchResults:o.searchResults||[],citations:o.citations||[]},i={event_id:`func_result_${e}`,type:"conversation.item.create",item:{type:"function_call_output",call_id:e,output:JSON.stringify(n)}};if(log(`üìã Generated Realtime API event: ${JSON.stringify(i,null,2).substring(0,300)}...`),n.success){showResult("function-call-result","‚úÖ Function call simulation passed","success"),showResult("function-call-result",`üîç Search found ${n.searchResults.length} results`,"info"),showResult("function-call-result",`üìö Response has ${n.citations.length} citations`,"info");const e=n.response;e&&e.length>20&&/[.!?]/.test(e)?showResult("function-call-result",`üí¨ Response is voice-ready (${e.length} chars)`,"success"):showResult("function-call-result","‚ö†Ô∏è Response may not be suitable for voice output","error")}else showResult("function-call-result",`‚ùå Function call failed: ${n.error}`,"error")}catch(e){log(`‚ùå Function call simulation error: ${e.message}`),showResult("function-call-result",`‚ùå Error: ${e.message}`,"error")}}async function testVoiceIntegration(){log("üé§ Starting Voice Integration Test");document.getElementById("voice-integration-result").innerHTML="";try{showResult("voice-integration-result","üîß Checking voice agent configuration...","info");const e=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"test connection"})});if(!e.ok)throw new Error(`Endpoint not accessible: ${e.status}`);showResult("voice-integration-result","‚úÖ Search endpoint accessible","success");const t="Tell me about machine learning algorithms";log(`üé§ Testing voice-optimized query: "${t}"`);const s=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,conversationContext:"User is speaking via voice interface"})}),o=await s.json();if(!s.ok||!o.success)throw new Error(`Voice search failed: ${o.error}`);{showResult("voice-integration-result","‚úÖ Voice-optimized search successful","success");const e=o.response;e&&e.length>=50&&showResult("voice-integration-result",`üí¨ Response is appropriate length for speech (${e.length} chars)`,"success"),o.searchResults&&o.searchResults.length>0&&showResult("voice-integration-result",`üìä Found ${o.searchResults.length} search results`,"info");const s=JSON.stringify({success:o.success,query:t,response:o.response,searchResults:o.searchResults,citations:o.citations});log(`üìã Function output size: ${s.length} bytes`),s.length<5e4?showResult("voice-integration-result","‚úÖ Function output is reasonable size","success"):showResult("voice-integration-result","‚ö†Ô∏è Function output may be too large","error")}}catch(e){log(`‚ùå Voice integration test error: ${e.message}`),showResult("voice-integration-result",`‚ùå Error: ${e.message}`,"error")}}async function testCitationExtraction(){log("üìö Starting Citation Extraction Test");document.getElementById("citation-result").innerHTML="";try{const e="Latest research on neural networks";log(`üîç Testing citation extraction with: "${e}"`);const t=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})}),s=await t.json();if(!t.ok||!s.success)throw new Error(`Search failed: ${s.error}`);if(log(`üìä Response received with ${s.citations?.length||0} citations`),s.citations&&s.citations.length>0){showResult("citation-result",`‚úÖ Citations extracted successfully (${s.citations.length} citations)`,"success");const e=s.citations[0];["type","url","title"].every((t=>e[t]))?(showResult("citation-result","‚úÖ Citation format is valid","success"),showResult("citation-result",`üîó Example citation: ${e.title}`,"info")):showResult("citation-result","‚ö†Ô∏è Citation missing required fields","error");try{new URL(e.url),showResult("citation-result","‚úÖ Citation URLs are valid","success")}catch{showResult("citation-result",`‚ùå Invalid citation URL: ${e.url}`,"error")}}else showResult("citation-result","‚ö†Ô∏è No citations found (may be expected for some queries)","info");if(s.searchResults&&s.searchResults.length>0){showResult("citation-result",`üìÑ Search results: ${s.searchResults.length} items`,"info");const e=s.searchResults[0];["title","url","snippet","source"].every((t=>e[t]))?showResult("citation-result","‚úÖ Search results have proper structure","success"):showResult("citation-result","‚ùå Search results missing required fields","error")}}catch(e){log(`‚ùå Citation extraction test error: ${e.message}`),showResult("citation-result",`‚ùå Error: ${e.message}`,"error")}}document.addEventListener("DOMContentLoaded",(()=>{log("üöÄ Voice Search Integration Test initialized"),log("üìç Test environment: "+window.location.origin)}))</script></body></html>