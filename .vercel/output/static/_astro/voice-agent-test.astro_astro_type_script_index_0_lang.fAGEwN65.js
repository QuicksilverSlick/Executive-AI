function e(e,t="info"){const n=document.getElementById("debug-output"),o=(new Date).toISOString().split("T")[1].split(".")[0],s=document.createElement("div");s.className={info:"text-green-400",warn:"text-yellow-400",error:"text-red-400",success:"text-blue-400"}[t]||"text-green-400",s.textContent=`[${o}] ${e}`,n.appendChild(s),n.scrollTop=n.scrollHeight}function t(e,t,n=!1){const o=document.getElementById(e);if(!o)return;const s=o.querySelector(".w-3.h-3"),i=o.querySelector("span");s&&(s.className="w-3 h-3 rounded-full "+(n?"bg-green-500":"bg-red-500")),i&&(i.textContent=t)}async function n(){e("Testing token endpoint...","info");try{const n=await fetch("/api/voice-agent/token",{method:"POST",headers:{"Content-Type":"application/json"}});if(n.ok){const o=await n.json();return e("Token endpoint test successful","success"),t("token-status","Valid token received",!0),o}throw new Error(`HTTP ${n.status}`)}catch(n){throw e(`Token endpoint test failed: ${n.message}`,"error"),t("token-status","Token request failed",!1),n}}async function o(){e("Testing health check...","info");try{const t=await fetch("/api/voice-agent/health");if(t.ok){const n=await t.json();return e("Health check successful","success"),n}throw new Error(`HTTP ${t.status}`)}catch(t){throw e(`Health check failed: ${t.message}`,"error"),t}}async function s(){e("Testing microphone access...","info");try{const n=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});return e("Microphone access granted","success"),t("audio-status","Microphone accessible",!0),n.getTracks().forEach((e=>e.stop())),!0}catch(n){throw e(`Microphone access failed: ${n.message}`,"error"),t("audio-status","Microphone access denied",!1),n}}function i(){e("Testing notification system...","info"),[{message:"Info notification test",type:"info"},{message:"Success notification test",type:"success"},{message:"Warning notification test",type:"warn"},{message:"Error notification test",type:"error"}].forEach(((t,n)=>{setTimeout((()=>{window.VoiceAssistantCore&&window.VoiceAssistantCore.showNotification(t.message,t.type),e(`Notification test ${n+1}/4: ${t.type}`,"info")}),1e3*n)}))}function c(){e("Expanding voice widget...","info"),window.VoiceAssistantCore?(window.VoiceAssistantCore.expandPanel(),e("Widget expanded successfully","success")):e("Voice assistant not found","error")}function a(){e("Minimizing voice widget...","info"),window.VoiceAssistantCore?(window.VoiceAssistantCore.minimizePanel(),e("Widget minimized successfully","success")):e("Voice assistant not found","error")}async function r(){e("Starting comprehensive test suite...","info");const t=[{name:"Health Check",fn:o},{name:"Token Endpoint",fn:n},{name:"Microphone Access",fn:s}];let i=0,c=t.length;for(const n of t){try{await n.fn(),i++,e(`✓ ${n.name} passed`,"success")}catch(t){e(`✗ ${n.name} failed: ${t.message}`,"error")}await new Promise((e=>setTimeout(e,500)))}e(`Test suite completed: ${i}/${c} tests passed`,i===c?"success":"warn")}document.addEventListener("DOMContentLoaded",(()=>{e("Voice agent test page initialized","info"),function(){const e=[{name:"WebRTC",supported:!(!window.RTCPeerConnection&&!window.webkitRTCPeerConnection)},{name:"getUserMedia",supported:!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},{name:"Web Audio API",supported:!(!window.AudioContext&&!window.webkitAudioContext)},{name:"WebSockets",supported:!!window.WebSocket},{name:"ES6 Modules",supported:"noModule"in HTMLScriptElement.prototype},{name:"Fetch API",supported:!!window.fetch}],t=document.getElementById("browser-compat");e.forEach((e=>{const n=document.createElement("div");n.className="flex items-center gap-2";const o=e.supported?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",s=e.supported?"✓":"✗";n.innerHTML=`\n          <span class="${o} font-mono">${s}</span>\n          <span class="text-gray-700 dark:text-gray-300">${e.name}</span>\n        `,t.appendChild(n)}))}(),document.getElementById("test-token")?.addEventListener("click",n),document.getElementById("test-health")?.addEventListener("click",o),document.getElementById("test-microphone")?.addEventListener("click",s),document.getElementById("test-notifications")?.addEventListener("click",i),document.getElementById("test-widget-expand")?.addEventListener("click",c),document.getElementById("test-widget-minimize")?.addEventListener("click",a),document.getElementById("test-all")?.addEventListener("click",r),document.getElementById("clear-debug")?.addEventListener("click",(()=>{document.getElementById("debug-output").innerHTML="",e("Debug console cleared","info")})),setTimeout((()=>{window.VoiceAssistantCore?(e("Voice assistant core detected","success"),t("webrtc-status","Core initialized",!0)):e("Voice assistant core not found","warn")}),2e3)}));