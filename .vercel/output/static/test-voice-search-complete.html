<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Voice Search Complete Integration Test</title><style>body{font-family:system-ui,-apple-system,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);min-height:100vh}.container{background:#fff;border-radius:12px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.1)}h1{color:#333;margin-bottom:10px}.subtitle{color:#666;margin-bottom:30px}.test-section{margin:30px 0;padding:20px;background:#f8f9fa;border-radius:8px;border-left:4px solid #667eea}.test-title{font-weight:700;color:#333;margin-bottom:15px;font-size:18px}.test-description{color:#666;margin-bottom:15px;line-height:1.6}.console-output{background:#1e1e1e;color:#d4d4d4;padding:15px;border-radius:8px;font-family:'Courier New',monospace;font-size:14px;max-height:500px;overflow-y:auto;margin-top:20px}.log-entry{margin:5px 0;padding:5px;border-left:3px solid transparent}.log-info{border-left-color:#4a9eff}.log-success{border-left-color:#4caf50;color:#a5d6a7}.log-error{border-left-color:#f44336;color:#ef9a9a}.log-search{border-left-color:#ff9800;color:#ffcc80}.log-result{border-left-color:#9c27b0;color:#ce93d8}button{background:#667eea;color:#fff;border:none;padding:12px 24px;border-radius:6px;font-size:16px;cursor:pointer;transition:all .3s;margin:5px}button:hover{background:#5a67d8;transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.3)}button:disabled{background:#ccc;cursor:not-allowed;transform:none}.status-indicator{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:8px;animation:pulse 2s infinite}.status-indicator.ready{background:#4caf50}.status-indicator.testing{background:#ff9800}.status-indicator.error{background:#f44336}@keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}.code-block{background:#f5f5f5;border:1px solid #ddd;border-radius:4px;padding:10px;margin:10px 0;font-family:'Courier New',monospace;font-size:14px;overflow-x:auto}</style></head><body><div class=container><h1>üîÑ Voice Search Complete Integration Test</h1><p class=subtitle>Verifying end-to-end voice agent search functionality with OpenAI Realtime API</p><div class=test-section><div class=test-title><span class="ready status-indicator" id=statusIndicator></span> Test Overview</div><div class=test-description>This test verifies that:<ol><li>The voice agent correctly triggers web_search function calls</li><li>The search endpoint returns proper results with citations</li><li>Search results are included in the function call response</li><li>The AI naturally integrates search results into voice responses</li></ol></div></div><div class=test-section><div class=test-title>üß™ Integration Flow Test</div><div class=test-description>Simulates the complete flow from voice query to search results to voice response.</div><button onclick=testCompleteFlow()>Run Complete Flow Test</button> <button onclick=testSearchEndpoint()>Test Search Endpoint Only</button> <button onclick=testFunctionCallFormat()>Test Function Call Format</button> <button onclick=clearConsole()>Clear Console</button></div><div class=test-section><div class=test-title>üìù Example Voice Conversations</div><div class=test-description>Test these conversational search queries:</div><div class=code-block>User: "Can you look up information about SRI Energy?" AI: "Let me search for information about SRI Energy for you..." [Executes web_search function] AI: "I found that SRI Energy is a leading renewable energy company..."</div><div class=code-block>User: "What AI tools are my restaurant competitors using?" AI: "I'll search for AI tools being used in the restaurant industry..." [Executes web_search function] AI: "Based on current information, many restaurants are adopting..."</div></div><div class=console-output id=console><div class="log-entry log-info">Integration test console ready...</div></div></div><script>function log(e,s="info"){const t=document.getElementById("console"),o=document.createElement("div");o.className=`log-entry log-${s}`;const n=(new Date).toLocaleTimeString();o.textContent=`[${n}] ${e}`,t.appendChild(o),t.scrollTop=t.scrollHeight}function updateStatus(e){document.getElementById("statusIndicator").className=`status-indicator ${e}`}async function testCompleteFlow(){log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","info"),log("COMPLETE VOICE SEARCH FLOW TEST","info"),log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","info"),updateStatus("testing");try{log("","info"),log("STEP 1: Simulating voice query","info"),log('User says: "What is SRI Energy company?"',"search"),log("","info"),log("STEP 2: Voice agent triggers function call","info");const e={name:"web_search",arguments:{query:"SRI Energy company information renewable energy"}};log("Function call: "+JSON.stringify(e,null,2),"info"),log("","info"),log("STEP 3: Executing search via /api/voice-agent/responses-search","info");const s=Date.now(),t=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e.arguments.query,conversationContext:"User asked: What is SRI Energy company?"})}),o=Date.now()-s,n=await t.json();if(log(`Search completed in ${o}ms`,"success"),log("","info"),log("STEP 4: Search results received","info"),!n.success)throw new Error(n.error||"Search failed");{log("‚úì Search successful","success"),n.response&&(log("Natural language response:","result"),log(n.response.substring(0,300)+"...","result")),n.searchResults&&n.searchResults.length>0&&(log(`Found ${n.searchResults.length} search results:`,"result"),n.searchResults.slice(0,3).forEach(((e,s)=>{log(`  ${s+1}. ${e.title||"Untitled"}`,"result"),log(`     Source: ${e.source||"Unknown"}`,"result"),e.snippet&&log(`     Snippet: ${e.snippet.substring(0,100)}...`,"result")}))),n.citations&&n.citations.length>0&&(log(`Found ${n.citations.length} citations:`,"result"),n.citations.slice(0,3).forEach(((e,s)=>{log(`  [${s+1}] ${e.title}: ${e.url}`,"result")}))),log("","info"),log("STEP 5: Function result sent back to voice agent","info");const s={success:!0,query:e.arguments.query,response:n.response,searchResults:n.searchResults||[],citations:n.citations||[]};log("Function result includes:","info"),log(`  - success: ${s.success}`,"info"),log(`  - response: "${s.response?.substring(0,80)}..."`,"info"),log(`  - searchResults: ${s.searchResults.length} results`,"info"),log(`  - citations: ${s.citations.length} citations`,"info"),log("","info"),log("STEP 6: AI voice response (synthesized from search results)","info"),log("AI would say:","success"),log(`"${n.response}"`,"success"),log("","info"),log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","success"),log("‚úÖ COMPLETE FLOW TEST PASSED","success"),log("Voice agent successfully:","success"),log("  1. Recognized search intent","success"),log("  2. Executed web_search function","success"),log("  3. Received search results with citations","success"),log("  4. Included all data in function result","success"),log("  5. Would synthesize natural voice response","success"),log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","success")}}catch(e){return log(`‚úó Test failed: ${e.message}`,"error"),void updateStatus("error")}updateStatus("ready")}async function testSearchEndpoint(){log("Testing search endpoint directly...","info"),updateStatus("testing");try{const e=["AI tools for restaurants","SRI Energy renewable company","dental practice automation software"];for(const s of e){log(`Testing: "${s}"`,"search");const e=await fetch("/api/voice-agent/responses-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s})}),t=await e.json();t.success?(log(`‚úì Success - Response: ${t.response?.substring(0,100)}...`,"success"),t.citations?.length>0&&log(`  Found ${t.citations.length} citations`,"result")):log(`‚úó Failed: ${t.error}`,"error")}}catch(e){return log(`Error: ${e.message}`,"error"),void updateStatus("error")}updateStatus("ready")}function testFunctionCallFormat(){log("Testing function call format...","info");const e={type:"function",name:"web_search",call_id:"call_"+Math.random().toString(36).substr(2,9),arguments:{query:"restaurant AI tools competitors"}};log("Example function call from voice agent:","info"),log(JSON.stringify(e,null,2),"result");const s={success:!0,query:e.arguments.query,response:"Based on my search, many restaurants are implementing AI tools for order management, customer service chatbots, and inventory optimization...",searchResults:[{title:"Top AI Tools for Restaurants in 2025",url:"https://example.com/ai-restaurant-tools",snippet:"Leading restaurants are using AI for...",source:"example.com"}],citations:[{type:"url_citation",title:"Restaurant AI Adoption Report",url:"https://example.com/report",start_index:20,end_index:45}]};log("Expected function result format:","info"),log(JSON.stringify(s,null,2),"result"),log("‚úì Function call format verified","success")}function clearConsole(){document.getElementById("console").innerHTML='<div class="log-entry log-info">Console cleared...</div>'}log("Voice Search Integration Test Ready","info"),log("This test verifies the complete flow from voice query ‚Üí search ‚Üí response","info"),log('Click "Run Complete Flow Test" to begin',"info")</script></body></html>