<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>WebRTC Voice Agent Test</title><style>body{font-family:Arial,sans-serif;max-width:600px;margin:50px auto;padding:20px}.status{padding:10px;margin:10px 0;border-radius:5px;text-align:center}.connected{background-color:#d4edda;color:#155724}.error{background-color:#f8d7da;color:#721c24}.info{background-color:#d1ecf1;color:#0c5460}button{padding:10px 20px;margin:5px;border:none;border-radius:5px;background-color:#007bff;color:#fff;cursor:pointer}button:hover{background-color:#0056b3}button:disabled{background-color:#6c757d}#transcript{border:1px solid #ddd;padding:10px;margin-top:20px;height:200px;overflow-y:auto;background-color:#f9f9f9}.message{margin:5px 0;padding:5px}.user{background-color:#e3f2fd}.assistant{background-color:#f3e5f5}</style></head><body><h1>WebRTC Voice Agent Test</h1><div class="info status" id=status>Initializing...</div><div style=text-align:center><button id=initBtn onclick=initialize()>Initialize Voice Agent</button> <button id=testBtn onclick=testResponse() disabled=disabled>Test Response</button> <button id=disconnectBtn onclick=disconnect() disabled=disabled>Disconnect</button></div><div id=transcript><div class="info message">Click "Initialize Voice Agent" to start...</div></div><script type=module>let voiceAgent=null;function setupEventListeners(){voiceAgent.on("connectionStateChanged",(e=>{addMessage(`Connection state: ${e}`,"info"),"connected"===e?updateStatus("Connected - Listening","connected"):"disconnected"===e&&updateStatus("Disconnected","error")})),voiceAgent.on("conversationStateChanged",(e=>{addMessage(`Conversation state: ${e}`,"info"),"listening"===e?updateStatus("Connected - Listening","connected"):"processing"===e?updateStatus("Processing...","info"):"speaking"===e&&updateStatus("Assistant Speaking","info")})),voiceAgent.on("userTranscript",(e=>{addMessage(`You: ${e.text}`,"user")})),voiceAgent.on("assistantTranscript",(e=>{addMessage(`Assistant: ${e.text}`,"assistant")})),voiceAgent.on("speechStarted",(()=>{addMessage("Speech detected","info")})),voiceAgent.on("speechEnded",(()=>{addMessage("Speech ended","info")})),voiceAgent.on("playbackStarted",(()=>{addMessage("Assistant speaking...","info")})),voiceAgent.on("playbackFinished",(()=>{addMessage("Assistant finished speaking","info")})),voiceAgent.on("error",(e=>{addMessage(`Error: ${e.message}`,"error"),console.error("Voice agent error:",e)})),voiceAgent.connection&&(voiceAgent.connection.on("realtimeEvent",(e=>{console.log("Realtime event:",e),"session.created"===e.type?addMessage("Session created with OpenAI","info"):"input_audio_buffer.speech_started"===e.type?addMessage("OpenAI detected speech start","info"):"input_audio_buffer.speech_stopped"===e.type?addMessage("OpenAI detected speech stop","info"):"response.audio_transcript.done"===e.type&&addMessage("Transcript received from OpenAI","info")})),voiceAgent.connection.on("audioTrack",(e=>{addMessage("Audio track received from OpenAI!","info"),console.log("Audio stream:",e)})))}window.addMessage=function(e,t="info"){const n=document.getElementById("transcript"),i=document.createElement("div");i.className=`message ${t}`,i.textContent=`[${(new Date).toLocaleTimeString()}] ${e}`,n.appendChild(i),n.scrollTop=n.scrollHeight},window.updateStatus=function(e,t="info"){const n=document.getElementById("status");n.textContent=e,n.className=`status ${t}`},window.initialize=async function(){try{updateStatus("Initializing...","info"),addMessage("Starting initialization...","info"),addMessage("Fetching authentication token...","info");const e=await fetch("/api/voice-agent/token",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get token: ${e.statusText}`);const t=await e.json();addMessage(`Token received: ${t.session_id}`,"info"),addMessage("Loading WebRTC Voice Agent module...","info");const n=(await import("/src/lib/voice-agent/webrtc/main.ts")).WebRTCVoiceAgent;voiceAgent=new n({apiEndpoint:"/api/voice-agent",features:{continuousListening:!0,autoReconnect:!0,echoCancellation:!0,noiseSuppression:!0}}),setupEventListeners(),addMessage("Initializing voice agent...","info"),await voiceAgent.initialize(),updateStatus("Connected - Listening","connected"),addMessage("Voice agent ready! Start speaking...","assistant"),document.getElementById("initBtn").disabled=!0,document.getElementById("testBtn").disabled=!1,document.getElementById("disconnectBtn").disabled=!1,window.voiceAgent=voiceAgent}catch(e){updateStatus("Initialization Failed","error"),addMessage(`Error: ${e.message}`,"error"),console.error("Initialization error:",e)}},window.testResponse=function(){voiceAgent&&voiceAgent.testResponse&&(addMessage("Triggering test response...","info"),voiceAgent.testResponse())},window.disconnect=async function(){voiceAgent&&(addMessage("Disconnecting...","info"),await voiceAgent.disconnect(),updateStatus("Disconnected","info"),document.getElementById("initBtn").disabled=!1,document.getElementById("testBtn").disabled=!0,document.getElementById("disconnectBtn").disabled=!0)}</script></body></html>