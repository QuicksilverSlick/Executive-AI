---
/*
 * DREAMFORGE HIVE-MIND CHAIN OF CUSTODY
 *
 * @file-purpose: Main voice assistant widget component with floating interface
 * @version: 1.0.0
 * @init-author: real-time-ui-agent
 * @init-cc-sessionId: cc-ui-20250801-001
 * @init-timestamp: 2025-08-01T04:26:00Z
 * @reasoning:
 * - **Objective:** Create main floating voice assistant widget component
 * - **Strategy:** React-based component with voice activation and real-time features
 * - **Outcome:** Professional voice assistant interface with full accessibility
 */

interface Props {
  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';
  theme?: 'auto' | 'light' | 'dark';
  apiEndpoint?: string;
  showTranscript?: boolean;
  enableKeyboardShortcut?: boolean;
  autoMinimize?: boolean;
}

const {
  position = 'bottom-right',
  theme = 'auto',
  apiEndpoint = '/api/voice-assistant',
  showTranscript = true,
  enableKeyboardShortcut = true,
  autoMinimize = true
} = Astro.props;

const positionClasses = {
  'bottom-right': 'bottom-6 right-6',
  'bottom-left': 'bottom-6 left-6',
  'top-right': 'top-6 right-6',
  'top-left': 'top-6 left-6'
};
---

<!-- Voice Assistant Widget Container -->
<div 
  id="voice-assistant-widget"
  class={`fixed ${positionClasses[position]} z-[1000] voice-widget-container`}
  role="region"
  aria-label="Voice Assistant"
  data-theme={theme}
  data-api-endpoint={apiEndpoint}
  data-show-transcript={showTranscript}
  data-enable-keyboard={enableKeyboardShortcut}
  data-auto-minimize={autoMinimize}
>
  <!-- Widget Main Panel (Initially Hidden) -->
  <div 
    id="voice-widget-panel"
    class="voice-widget-panel hidden mb-4 w-80 bg-white dark:bg-dark-surface-2 rounded-2xl shadow-2xl border border-gray-200 dark:border-dark-border backdrop-blur-lg"
    role="dialog"
    aria-labelledby="voice-widget-title"
    aria-describedby="voice-widget-description"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-dark-border">
      <div class="flex items-center space-x-3">
        <div class="voice-status-indicator w-3 h-3 rounded-full bg-gray-400 dark:bg-dark-text-muted transition-colors duration-300"></div>
        <h3 id="voice-widget-title" class="text-sm font-semibold text-gray-900 dark:text-dark-text">
          AI Assistant
        </h3>
      </div>
      <div class="flex items-center space-x-2">
        <!-- Mute/Unmute Button -->
        <button
          id="voice-mute-btn"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-surface-3 transition-colors"
          aria-label="Mute/Unmute"
          title="Mute/Unmute"
        >
          <svg class="w-4 h-4 text-gray-600 dark:text-dark-text-secondary" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.794L4.168 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.168l4.215-3.794zm2.617 5.11a1 1 0 011.414 0L15 9.772l1.586-1.586a1 1 0 011.414 1.414L16.414 11.2 18 12.786a1 1 0 01-1.414 1.414L15 12.614l-1.586 1.586a1 1 0 01-1.414-1.414L13.586 11.2 12 9.614a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </button>
        <!-- Minimize Button -->
        <button
          id="voice-minimize-btn"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-surface-3 transition-colors"
          aria-label="Minimize"
          title="Minimize"
        >
          <svg class="w-4 h-4 text-gray-600 dark:text-dark-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Voice Visualization Area -->
    <div class="p-4">
      <div class="voice-visualization-container relative h-24 mb-4 bg-gray-50 dark:bg-dark-surface rounded-xl overflow-hidden">
        <!-- Waveform Canvas -->
        <canvas 
          id="voice-waveform-canvas"
          class="absolute inset-0 w-full h-full"
          width="320"
          height="96"
          aria-hidden="true"
        ></canvas>
        
        <!-- Status Overlay -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="voice-status-display text-center">
            <div class="voice-animation-indicator mb-2">
              <!-- Animated dots for different states -->
              <div class="flex items-center justify-center space-x-1">
                <div class="w-2 h-2 bg-accent-gold rounded-full opacity-30 animate-pulse"></div>
                <div class="w-2 h-2 bg-accent-gold rounded-full opacity-50 animate-pulse" style="animation-delay: 0.2s"></div>
                <div class="w-2 h-2 bg-accent-gold rounded-full opacity-70 animate-pulse" style="animation-delay: 0.4s"></div>
              </div>
            </div>
            <p id="voice-status-text" class="text-sm text-gray-600 dark:text-dark-text-secondary">
              Click to start speaking
            </p>
          </div>
        </div>
      </div>

      <!-- Control Buttons -->
      <div class="flex items-center justify-center space-x-4 mb-4">
        <!-- Main Voice Button -->
        <button
          id="voice-main-btn"
          class="voice-main-button relative w-16 h-16 bg-gradient-to-r from-accent-gold to-brand-gold-warm rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-gold/30"
          aria-label="Start/Stop voice interaction"
          title="Click to talk"
        >
          <!-- Microphone Icon -->
          <svg class="w-6 h-6 text-white absolute inset-0 m-auto" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
          </svg>
          
          <!-- Pulse Animation Ring -->
          <div class="voice-pulse-ring absolute inset-0 rounded-full border-2 border-accent-gold opacity-0"></div>
        </button>

        <!-- Voice Activation Toggle -->
        <button
          id="voice-activation-toggle"
          class="p-3 rounded-xl bg-gray-100 dark:bg-dark-surface-3 hover:bg-gray-200 dark:hover:bg-dark-surface-4 transition-colors"
          aria-label="Toggle voice activation"
          title="Toggle voice activation"
        >
          <svg class="w-5 h-5 text-gray-600 dark:text-dark-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M9 9a3 3 0 000 6v-6a3 3 0 000-6z" />
          </svg>
        </button>
      </div>

      <!-- Transcript Area -->
      <div class="voice-transcript-container max-h-48 overflow-y-auto">
        <div class="space-y-3">
          <!-- User Message Example -->
          <div class="voice-message user-message opacity-0 transform translate-y-2">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-accent-sky flex items-center justify-center flex-shrink-0">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="flex-1">
                <p class="text-sm text-gray-900 dark:text-dark-text bg-gray-100 dark:bg-dark-surface-3 rounded-lg px-3 py-2">
                  Sample user message will appear here
                </p>
                <span class="text-xs text-gray-500 dark:text-dark-text-muted mt-1 block">Just now</span>
              </div>
            </div>
          </div>

          <!-- Assistant Message Example -->
          <div class="voice-message assistant-message opacity-0 transform translate-y-2">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-accent-gold flex items-center justify-center flex-shrink-0">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                  <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z" />
                </svg>
              </div>
              <div class="flex-1">
                <p class="text-sm text-gray-900 dark:text-dark-text bg-gradient-to-r from-accent-gold/10 to-brand-gold-warm/10 border border-accent-gold/20 rounded-lg px-3 py-2">
                  AI Assistant response will appear here
                </p>
                <span class="text-xs text-gray-500 dark:text-dark-text-muted mt-1 block">Just now</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer with CTA -->
    <div class="p-4 border-t border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-surface rounded-b-2xl">
      <button
        id="voice-cta-btn"
        class="w-full bg-gradient-to-r from-accent-gold to-brand-gold-warm text-white font-semibold py-2 px-4 rounded-lg hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-accent-gold/30"
      >
        Book Discovery Call
      </button>
      <p class="text-xs text-gray-500 dark:text-dark-text-muted text-center mt-2">
        Powered by AI â€¢ Privacy Protected
      </p>
    </div>
  </div>

  <!-- Floating Action Button -->
  <button
    id="voice-fab"
    class="voice-fab w-14 h-14 bg-gradient-to-r from-accent-gold to-brand-gold-warm rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-accent-gold/30 flex items-center justify-center"
    aria-label="Open voice assistant"
    title="Open voice assistant"
  >
    <!-- Notification Badge -->
    <div class="voice-notification-badge absolute -top-1 -right-1 w-4 h-4 bg-semantic-error text-white text-xs rounded-full flex items-center justify-center opacity-0 scale-0 transition-all duration-300">
      1
    </div>
    
    <!-- Main Icon -->
    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
    </svg>
  </button>
</div>

<!-- Keyboard Shortcut Hint -->
<div 
  id="voice-keyboard-hint"
  class="fixed bottom-20 right-8 bg-gray-900 dark:bg-dark-surface-2 text-white dark:text-dark-text text-sm px-3 py-2 rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-300 z-[999]"
  role="tooltip"
>
  Press <kbd class="px-1 py-0.5 bg-gray-700 dark:bg-dark-surface-3 rounded text-xs">Space</kbd> to talk
</div>

<style>
  .voice-widget-container {
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .voice-widget-panel {
    transform-origin: bottom right;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .voice-widget-panel.hidden {
    opacity: 0;
    transform: scale(0.8) translateY(20px);
    pointer-events: none;
  }

  .voice-widget-panel.visible {
    opacity: 1;
    transform: scale(1) translateY(0);
    pointer-events: auto;
  }

  .voice-fab {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .voice-fab:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .voice-main-button:active {
    transform: scale(0.95);
  }

  .voice-pulse-ring {
    animation: voice-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes voice-pulse {
    0% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.3);
    }
    100% {
      opacity: 0;
      transform: scale(1.6);
    }
  }

  .voice-message {
    transition: all 0.3s ease-out;
  }

  .voice-message.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .voice-notification-badge.active {
    opacity: 1;
    transform: scale(1);
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    .voice-widget-panel,
    .voice-fab,
    .voice-message,
    .voice-pulse-ring {
      transition: none;
      animation: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .voice-widget-panel {
      border-width: 2px;
    }
    
    .voice-main-button {
      outline: 2px solid currentColor;
      outline-offset: 2px;
    }
  }

  /* Focus indicators */
  .voice-fab:focus-visible,
  .voice-main-button:focus-visible,
  button:focus-visible {
    outline: 2px solid #D4A034;
    outline-offset: 2px;
  }

  /* RTL support */
  [dir="rtl"] .voice-widget-container.bottom-right {
    left: 1.5rem;
    right: auto;
  }
  
  [dir="rtl"] .voice-widget-container.bottom-left {
    right: 1.5rem;
    left: auto;
  }

  /* Error states */
  .voice-widget-panel.error {
    border-color: #F43F5E;
  }

  .voice-status-indicator.error {
    background-color: #F43F5E;
    animation: voice-pulse 1s ease-in-out infinite;
  }

  .voice-status-indicator.listening {
    background-color: #10B981;
    animation: voice-pulse 2s ease-in-out infinite;
  }

  .voice-status-indicator.thinking {
    background-color: #F59E0B;
    animation: voice-pulse 1.5s ease-in-out infinite;
  }

  .voice-status-indicator.speaking {
    background-color: #3B82F6;
    animation: voice-pulse 1s ease-in-out infinite;
  }
</style>

<script>
  // Initialize voice assistant widget functionality
  import '/src/components/voice-agent/voice-assistant-core.js';
</script>