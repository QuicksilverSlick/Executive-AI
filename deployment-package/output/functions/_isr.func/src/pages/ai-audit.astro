---
import Layout from '../layouts/Layout.astro';
import Button from '../components/Button.astro';
import AuditTracking from '../components/AuditTracking.astro';
import Icon from '../components/Icon.astro';
---

<Layout title="AI Opportunity Audit">
  <section class="section-padding">
    <div class="container-narrow">
      <div class="max-w-3xl mx-auto">
        <div class="text-center mb-12">
          <h1 class="text-4xl md:text-5xl font-bold text-brand-charcoal dark:text-dark-text mb-4">
            Your AI Opportunity Audit
          </h1>
          <p class="text-xl text-gray-700 dark:text-dark-text-secondary">
            Answer 5 strategic questions to discover your #1 AI opportunity
          </p>
          <div class="mt-4 flex items-center justify-center gap-2">
            <Icon name="lucide:check-circle" class="w-5 h-5 text-brand-gold dark:text-accent-emerald" />
            <span class="text-sm text-gray-600 dark:text-dark-text-tertiary">Takes less than 2 minutes</span>
          </div>
        </div>

        <!-- Audit Form -->
        <div id="audit-wizard" class="audit-wizard bg-white dark:bg-dark-surface rounded-lg shadow-lg dark:shadow-black/30 p-8 border border-gray-100 dark:border-dark-border">
          <!-- Progress Bar -->
          <div class="mb-8">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-gray-600 dark:text-dark-text-tertiary">Progress</span>
              <span class="text-sm text-gray-600 dark:text-dark-text-tertiary">
                <span id="current-step">1</span> of 5
              </span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-dark-surface-3 rounded-full h-2">
              <div id="progress-bar" class="bg-brand-gold dark:bg-accent-amber h-2 rounded-full transition-all duration-300" style="width: 20%"></div>
            </div>
          </div>

          <!-- Question Container -->
          <form id="audit-form">
            <!-- Step 1: Industry -->
            <div class="step" data-step="1">
              <h2 class="text-2xl font-semibold mb-6 text-brand-charcoal dark:text-dark-text">What industry are you in?</h2>
              <div class="space-y-3">
                <label class="audit-option">
                  <input type="radio" name="industry" value="finance" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:banknote" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>Finance & Banking</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="industry" value="healthcare" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:heart-pulse" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>Healthcare</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="industry" value="technology" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:laptop" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>Technology</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="industry" value="retail" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:shopping-bag" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>Retail & E-commerce</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="industry" value="other" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:building-2" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>Other</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Step 2: Company Size -->
            <div class="step hidden" data-step="2">
              <h2 class="text-2xl font-semibold mb-6">How many employees does your company have?</h2>
              <div class="space-y-3">
                <label class="audit-option">
                  <input type="radio" name="size" value="small" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:users" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>1-50 employees</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="size" value="medium" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:users-2" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>51-500 employees</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="size" value="large" class="sr-only">
                  <div class="option-card">
                    <Icon name="lucide:building-2" class="w-8 h-8 text-brand-gold dark:text-accent-amber mx-auto mb-2" />
                    <span>500+ employees</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Step 3: AI Experience -->
            <div class="step hidden" data-step="3">
              <h2 class="text-2xl font-semibold mb-6">What's your current AI experience level?</h2>
              <div class="space-y-3">
                <label class="audit-option">
                  <input type="radio" name="experience" value="none" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üå±</span>
                    <span>Just starting to explore AI</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="experience" value="basic" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üåø</span>
                    <span>Using basic AI tools (ChatGPT, etc.)</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="experience" value="intermediate" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üå≥</span>
                    <span>Implementing AI in some processes</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="experience" value="advanced" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üöÄ</span>
                    <span>Advanced AI integration</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Step 4: Pain Points -->
            <div class="step hidden" data-step="4">
              <h2 class="text-2xl font-semibold mb-6">What's your biggest business challenge right now?</h2>
              <div class="space-y-3">
                <label class="audit-option">
                  <input type="radio" name="challenge" value="efficiency" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">‚ö°</span>
                    <span>Operational efficiency</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="challenge" value="customer" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">ü§ù</span>
                    <span>Customer experience</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="challenge" value="data" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üìä</span>
                    <span>Data analysis & insights</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="challenge" value="competition" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üèÅ</span>
                    <span>Staying ahead of competition</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Step 5: Budget -->
            <div class="step hidden" data-step="5">
              <h2 class="text-2xl font-semibold mb-6">What's your annual budget for strategic initiatives?</h2>
              <div class="space-y-3">
                <label class="audit-option">
                  <input type="radio" name="budget" value="low" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üíµ</span>
                    <span>Under $50K</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="budget" value="medium" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üíµüíµ</span>
                    <span>$50K - $250K</span>
                  </div>
                </label>
                <label class="audit-option">
                  <input type="radio" name="budget" value="high" class="sr-only">
                  <div class="option-card">
                    <span class="option-icon">üíµüíµüíµ</span>
                    <span>$250K+</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Results Step -->
            <div class="step hidden" data-step="results">
              <div class="text-center">
                <div class="mb-6">
                  <svg class="w-20 h-20 text-brand-gold mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                  <h2 class="text-3xl font-bold text-brand-charcoal mb-4">
                    Your AI Opportunity Report is Ready!
                  </h2>
                  <p class="text-lg text-gray-700 mb-8">
                    Enter your email to receive your personalized AI strategy brief
                  </p>
                </div>
                
                <form id="email-form" class="max-w-md mx-auto">
                  <div class="mb-4">
                    <input 
                      type="email" 
                      name="email" 
                      required
                      placeholder="your@email.com"
                      class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-transparent"
                    >
                  </div>
                  <Button type="submit" class="w-full" data-submit-audit>
                    Get My AI Opportunity Report
                  </Button>
                  <p class="text-xs text-gray-500 mt-3">
                    100% private. No spam. Unsubscribe anytime.
                  </p>
                </form>
              </div>
            </div>

            <!-- Navigation -->
            <div class="mt-8 flex justify-between items-center">
              <button 
                type="button" 
                id="prev-btn" 
                class="text-gray-600 hover:text-brand-blue transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                data-step-button
                data-action="prev"
                disabled
              >
                ‚Üê Previous
              </button>
              <button 
                type="button" 
                id="next-btn" 
                class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
                data-step-button
                data-action="next"
                disabled
              >
                Next ‚Üí
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .audit-option {
    display: block;
    cursor: pointer;
  }
  
  .option-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 100px;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
  }
  
  :global(.dark) .option-card {
    border-color: #2C2C2C;
    background-color: #1E1E1E;
    color: #E0E0E0;
  }
  
  .option-card:hover {
    border-color: #B48628;
    background-color: #fef3c7;
  }
  
  :global(.dark) .option-card:hover {
    border-color: #FBBF24;
    background-color: #1E1E1E;
  }
  
  .audit-option input:checked + .option-card {
    border-color: #B48628;
    background-color: #fef3c7;
    font-weight: 600;
  }
  
  :global(.dark) .audit-option input:checked + .option-card {
    border-color: #FBBF24;
    background-color: #242424;
  }
  
  .option-icon {
    font-size: 1.5rem;
  }
  
  .step {
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  let currentStep = 1;
  const totalSteps = 5;
  
  const form = document.getElementById('audit-form') as HTMLFormElement;
  const emailForm = document.getElementById('email-form') as HTMLFormElement;
  const prevBtn = document.getElementById('prev-btn') as HTMLButtonElement;
  const nextBtn = document.getElementById('next-btn') as HTMLButtonElement;
  const progressBar = document.getElementById('progress-bar') as HTMLDivElement;
  const currentStepSpan = document.getElementById('current-step') as HTMLSpanElement;
  
  function showStep(step: number | 'results') {
    // Hide all steps
    document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
    
    // Show current step
    const stepEl = document.querySelector(`[data-step="${step}"]`);
    if (stepEl) {
      stepEl.classList.remove('hidden');
    }
    
    // Update progress
    if (typeof step === 'number') {
      const progress = (step / totalSteps) * 100;
      progressBar.style.width = `${progress}%`;
      currentStepSpan.textContent = step.toString();
      
      // Update buttons
      prevBtn.disabled = step === 1;
      if (step === totalSteps) {
        nextBtn.textContent = 'Get Results';
      } else {
        nextBtn.textContent = 'Next ‚Üí';
      }
    } else {
      // Results page
      progressBar.style.width = '100%';
      prevBtn.classList.add('hidden');
      nextBtn.classList.add('hidden');
    }
    
    updateNextButton();
  }
  
  function updateNextButton() {
    const currentStepEl = document.querySelector(`[data-step="${currentStep}"]`);
    const hasSelection = currentStepEl?.querySelector('input[type="radio"]:checked');
    nextBtn.disabled = !hasSelection;
  }
  
  // Listen for radio changes
  form.addEventListener('change', updateNextButton);
  
  // Previous button
  prevBtn.addEventListener('click', () => {
    prevBtn.setAttribute('data-current-step', currentStep.toString());
    if (currentStep > 1) {
      currentStep--;
      showStep(currentStep);
    }
  });
  
  // Next button
  nextBtn.addEventListener('click', () => {
    nextBtn.setAttribute('data-current-step', currentStep.toString());
    if (currentStep < totalSteps) {
      currentStep++;
      showStep(currentStep);
    } else {
      // Show results
      showStep('results');
    }
  });
  
  // Email form submission
  emailForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const emailData = new FormData(emailForm);
    
    // Collect all data
    const auditData = {
      industry: formData.get('industry'),
      size: formData.get('size'),
      experience: formData.get('experience'),
      challenge: formData.get('challenge'),
      budget: formData.get('budget'),
      email: emailData.get('email')
    };
    
    // Here you would send to your backend
    console.log('Audit submission:', auditData);
    
    // Mark form as submitted for tracking
    const submitBtn = document.querySelector('[data-submit-audit]');
    if (submitBtn) {
      submitBtn.setAttribute('data-submitted', 'true');
    }
    
    // Show success message
    const resultsStep = document.querySelector('[data-step="results"]');
    if (resultsStep) {
      resultsStep.innerHTML = `
        <div class="text-center">
          <svg class="w-20 h-20 text-brand-gold mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <h2 class="text-3xl font-bold text-brand-charcoal mb-4">
            Check Your Email!
          </h2>
          <p class="text-lg text-gray-700 mb-6">
            Your personalized AI Opportunity Report has been sent to ${emailData.get('email')}
          </p>
          <a href="/" class="btn-primary">
            Return to Homepage
          </a>
        </div>
      `;
    }
  });
  
  // Initialize
  showStep(1);
</script>

<!-- Analytics Tracking -->
<AuditTracking />